<html>
<head>
    <title>WebPush iOS example</title>
    <link rel="canonical" href="https://andreinwald.github.io/webpush-ios-example/"/>
    <base href="https://andreinwald.github.io/webpush-ios-example/">

    <link rel="apple-touch-icon" href="images/favicon.png">
    <link rel="icon" type="image/png" href="images/favicon.png">
</head>
<body>

<script>
    // Code mostly from https://developer.apple.com/videos/play/wwdc2022/10098/

    if (navigator.serviceWorker) {
        // scope option provided only for github page case
        navigator.serviceWorker.register('https://andreinwald.github.io/webpush-ios-example/serviceworker.js', {scope: '/webpush-ios-example/'})
            .then((registration) => {
                registration.update();
            });
    }

    async function subscribeToPush() {
        // Public part of VAPID key, generation of that covered in README @TODO
        // All subscription tokens associated with that key, so if you change it - you may lost old subscribers
        const VAPID_PUBLIC_KEY = 'BAwUJxIa7mJZMqu78Tfy2Sb1BWnYiAatFCe1cxpnM-hxNtXjAwaNKz1QKLU8IYYhjUASOFzSvSnMgC00vfsU0IM';

        let swRegistration = await navigator.serviceWorker.getRegistration();
        let subscriptionOptions = {
            userVisibleOnly: true,
            applicationServerKey: VAPID_PUBLIC_KEY
        };
        let subscription = await swRegistration.pushManager.subscribe(subscriptionOptions);
        console.log('New subscription', subscription);
    }
</script>

<h1>WebPush iOS example</h1>

<button onclick="subscribeToPush()">Subscribe to notifications</button>


</body>
</html>
