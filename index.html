<html lang="en">
<head>
    <title>WebPush iOS example</title>
    <link rel="canonical" href="https://andreinwald.github.io/webpush-ios-example/"/>
    <base href="https://andreinwald.github.io/webpush-ios-example/">

    <link rel="apple-touch-icon" href="images/favicon.png">
    <link rel="icon" type="image/png" href="images/favicon.png">
</head>
<body>

<script>
    async function initServiceWorker() {
        let swRegistration = await navigator.serviceWorker.register('https://andreinwald.github.io/webpush-ios-example/serviceworker.js', {scope: '/webpush-ios-example/'})
        let pushManager = swRegistration.pushManager;
        let permissionState = await pushManager.permissionState({userVisibleOnly: true});
        switch (permissionState) {
            case 'prompt':
                break;
            case 'granted':
                let subscription = await pushManager.getSubscription();
                console.log('Active push subscription ', subscription.toJSON());
                break;
            case 'denied':
                console.log('Push Notifications denied by user');
        }
    }

    if (navigator.serviceWorker) {
        initServiceWorker();
    }

    async function subscribeToPush() {
        // Public part of VAPID key, generation of that covered in README
        // All subscription tokens associated with that key, so if you change it - you may lose old subscribers
        const VAPID_PUBLIC_KEY = 'BAwUJxIa7mJZMqu78Tfy2Sb1BWnYiAatFCe1cxpnM-hxNtXjAwaNKz1QKLU8IYYhjUASOFzSvSnMgC00vfsU0IM';

        let swRegistration = await navigator.serviceWorker.getRegistration();
        let subscriptionOptions = {
            userVisibleOnly: true,
            applicationServerKey: VAPID_PUBLIC_KEY
        };
        let subscription = await swRegistration.pushManager.subscribe(subscriptionOptions);
        console.log('New subscription', subscription);
    }
</script>

<h1>WebPush iOS example</h1>

<button onclick="subscribeToPush()">Subscribe to notifications</button>


</body>
</html>
