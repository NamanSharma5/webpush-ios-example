<html lang="en">
<head>
    <title>WebPush iOS example</title>
    <link rel="canonical" href="https://andreinwald.github.io/webpush-ios-example/"/>
    <base href="https://andreinwald.github.io/webpush-ios-example/">
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="apple-touch-icon" href="images/favicon.png">
    <link rel="icon" type="image/png" href="images/favicon.png">
</head>
<body>

<script>
    async function initServiceWorker() {
        let swRegistration = await navigator.serviceWorker.register('https://andreinwald.github.io/webpush-ios-example/serviceworker.js', {scope: '/webpush-ios-example/'})
        let pushManager = swRegistration.pushManager;
        let permissionState = await pushManager.permissionState({userVisibleOnly: true});
        switch (permissionState) {
            case 'prompt':
                break;
            case 'granted':
                let subscription = await pushManager.getSubscription();
                document.getElementById('active_sub').innerHTML = '<b>Active subscription:</b><br>' + JSON.stringify(subscription.toJSON(), null, 2);
                break;
            case 'denied':
                console.log('Push Notifications denied by user');
        }
    }

    if (navigator.serviceWorker) {
        initServiceWorker();
    }

    async function subscribeToPush() {
        // Public part of VAPID key, generation of that covered in README
        // All subscription tokens associated with that key, so if you change it - you may lose old subscribers
        const VAPID_PUBLIC_KEY = 'BAwUJxIa7mJZMqu78Tfy2Sb1BWnYiAatFCe1cxpnM-hxNtXjAwaNKz1QKLU8IYYhjUASOFzSvSnMgC00vfsU0IM';

        let swRegistration = await navigator.serviceWorker.getRegistration();
        let subscriptionOptions = {
            userVisibleOnly: true,
            applicationServerKey: VAPID_PUBLIC_KEY
        };
        let subscription = await swRegistration.pushManager.subscribe(subscriptionOptions);
        console.log('New subscription', subscription);
    }
</script>

<div style="max-width: 1200px;margin: 0 auto;">
    <h1>WebPush iOS example</h1>
    <button onclick="subscribeToPush()">Subscribe to notifications</button>
    <div id="active_sub" style="background-color: #e7e7ff;padding: 20px"></div>
</div>

</body>
</html>
